---
title: "MacrosystemGraphs_v1"
author: "sbsambado"
date: "9/28/2020"
output: html_document
---

## **Macrosystem Proposal**

Data are from NEON

This is some EDA for a grant proposal with MacDonald et al.

Data analyzed are: 

**questing I. scapularis abundances across**

+ sites of interest
+ peak activity during months of March - September
+ Years (2014 - 2019)


**attached I. scapularis on mammals across** 

+ sites of interest

*attached tick data needs to be tidied up more since it's currently in present/absent version*


```{r setup, include= FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(strip.white = TRUE)
```


```{r packages and code savers}
library(dplyr)
library(tidyverse)
library(stats)
library(base)
library(ggplot2)
library(gridExtra)
library(ggpubr)
library(lubridate)
library(caret)
library(splines)

clean_background <- theme(plot.background = element_rect("white"),
        panel.background = element_rect("white"),
        panel.grid = element_line("white"),
        axis.line = element_line("gray25"),
        axis.text = element_text(size = 12, color = "gray25"),
        axis.title = element_text(color = "gray25"),
        legend.text = element_text(size = 12),
        legend.key = element_rect("white"))

multiplottitletheme <- theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))

rotatexaxistheme <- theme(axis.text.x = element_text(angle = 90, size = 8, vjust = 0.5))

ytitletheme <- theme(axis.title.y = element_text(face = 'bold', size = 12, vjust = 0.5))

xtitletheme <- theme(axis.title.x = element_text(face = 'bold', size = 12, vjust = 0.5))


```


Original csv's are pulled from NEON.
On my computer, these files are stored in a different R Project/Git Repository called 'Macrosystems'

```{r pull original csvs}

# ticks
ticks <- read.csv("/Users/samanthasambado/Macrosystems/filesToStack10093/stackedFiles/tck_fielddata.csv", header=T)
#head(ticks)
#unique(ticks$siteID)
#tail(ticks)
#nrow(ticks)

# tick taxa
ticks_taxa <- read.csv("/Users/samanthasambado/Macrosystems/filesToStack10093/stackedFiles/tck_taxonomyProcessed.csv", header=T)
#head(ticks_taxa)
#nrow(ticks_taxa)

# mammals
mams <- read.csv("/Users/samanthasambado/Macrosystems/filesToStack10072/stackedFiles/mam_pertrapnight.csv", header=T)
#head(mams)
#nrow(mams)

# tick pathogens
tick_path <- read.csv("/Users/samanthasambado/Macrosystems/filesToStack10092/stackedFiles/tck_pathogen.csv", header=T)
#head(tick_path)
#nrow(tick_path)


```


# Andy's code to tidy up csv's

**Ticks**
```{r andy tidying csvs}
############## working thorugh tick taxa data frame #######
#unique(ticks_taxa$scientificName)
#nrow(ticks_taxa)


############## site selection #######
#extract plotID
ticks_taxa$site <- substr(ticks_taxa$plotID, 1, 4)

# how many unique sites
#unique(ticks_taxa$site)

# select sites that use this criteria
ticks_taxa_E <- ticks_taxa[which(ticks_taxa$site == 'BART' | ticks_taxa$site == 'HARV' | ticks_taxa$site == 'BLAN' | ticks_taxa$site == 'SCBI' | ticks_taxa$site == 'SERC' | ticks_taxa$site == 'OSBS' | ticks_taxa$site == 'STEI' | ticks_taxa$site == 'TREE' | ticks_taxa$site == 'UNDE' | ticks_taxa$site == 'GRSM' | ticks_taxa$site == 'MLBS' | ticks_taxa$site == 'ORNL' | ticks_taxa$site == 'TALL'),]


############## tick selection #######

# select deva
DVAR <- ticks_taxa_E[which(ticks_taxa_E$scientificName == 'Dermacentor variabilis'),]
#nrow(DVAR)
#head(DVAR)

# select deva larvae
DVAR_L <- DVAR[which(DVAR$sexOrAge == 'Larva'),]
#nrow(DVAR_L)

# select deva nymphs
DVAR_N <- DVAR[which(DVAR$sexOrAge == 'Nymph'),]
#nrow(DVAR_N)

# select iscap
ISCP <- ticks_taxa_E[which(ticks_taxa_E$scientificName == 'Ixodes scapularis'),]
#nrow(ISCP)

# select amblyomma
AAM <- ticks_taxa_E[which(ticks_taxa_E$scientificName == 'Amblyomma americanum'),]
#nrow(AAM)

# select amblyomma larva
AAM_L <- AAM[which(AAM$sexOrAge == 'Larva'),]
#nrow(AAM_L)

# select amblyomma nymph
AAM_N <- AAM[which(AAM$sexOrAge == 'Nymph'),]
#nrow(AAM_N)

# treat plot ID as character
ticks_taxa$plotID <- lapply(ticks_taxa$plotID, as.character)

# extract certain plots
ticks_taxa$siteID <- substr(ticks_taxa$plotID, 1, nchar(ticks_taxa$plotID)-4)
#head(ticks_taxa)

#plot(ticks_taxa$collectDate, ticks_taxa$individualCount)

# select columns
ticks_taxa2 <- ticks_taxa[,c(3,4,8,23,24,33)]
####View(head(ticks_taxa2, n=20))
#nrow(ticks_taxa2)


############## aggregating ixodes life stages #######

```

Nymphs
```{r}
######## Ixodes 


#Nymphs
I_scap_N <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Nymph' & ticks_taxa2$scientificName == 'Ixodes scapularis'),]
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_N, class)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)

I_scap_N$collectDate <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-7)
#head(I_scap_N)

I_scap_N$collectDate <- as.factor(I_scap_N$collectDate)
I_scap_N$plotID <- unlist(I_scap_N$plotID)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)
I_scap_N$Year <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-6)
#head(I_scap_N)

I_scap_N_2017 <- I_scap_N[which(I_scap_N$Year == '2017'),]
#head(I_scap_N_2017)

I_scap_N_col <- aggregate(individualCount ~ plotID + collectDate + site + Year, data=I_scap_N, FUN=sum)
#head(I_scap_N_col, n=20)
#nrow(I_scap_N_col)

#View(I_scap_N)


```

```{r}
#Larvae:
I_scap_L <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Larva'),]
#head(I_scap_L)
#nrow(I_scap_L)

sapply(I_scap_L, class)
I_scap_L$collectDate <- as.character(I_scap_L$collectDate)

I_scap_L$collectDate <- substr(I_scap_L$collectDate, 1, nchar(I_scap_L$collectDate)-7)
#head(I_scap_L)

I_scap_L$collectDate <- as.factor(I_scap_L$collectDate)
I_scap_L$plotID <- unlist(I_scap_L$plotID)


I_scap_L$collectDate <- as.character(I_scap_L$collectDate)
# extracting year out of collectDate
I_scap_L$Year <- substr(I_scap_L$collectDate, 1, nchar(I_scap_L$collectDate)-6)

#head(I_scap_L)

I_scap_L_2017 <- I_scap_L[which(I_scap_L$Year == '2017'),]
#head(I_scap_L_2017)

I_scap_L_col <- aggregate(individualCount ~ plotID + collectDate + site + Year, data=I_scap_L, FUN=sum)
#head(I_scap_L_col, n=20)
#nrow(I_scap_L_col)

###View(I_scap_L_col)


#Adults
I_scap_A <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Female' | ticks_taxa2$sexOrAge == 'Male'),]
I_scap_A <- I_scap_A[which(I_scap_A$scientificName == 'Ixodes scapularis'),]
#head(I_scap_A)
#nrow(I_scap_A)
sapply(I_scap_A, class)
I_scap_A$collectDate <- as.character(I_scap_A$collectDate)

I_scap_A$collectDate <- substr(I_scap_A$collectDate, 1, nchar(I_scap_A$collectDate)-7)
#head(I_scap_A)
I_scap_A$collectDate <- as.factor(I_scap_A$collectDate)
I_scap_A$plotID <- unlist(I_scap_A$plotID)
I_scap_A$collectDate <- as.character(I_scap_A$collectDate)
I_scap_A$Year <- substr(I_scap_A$collectDate, 1, nchar(I_scap_A$collectDate)-6)
#head(I_scap_A)

I_scap_A_2017 <- I_scap_A[which(I_scap_A$Year == '2017'),]
#head(I_scap_A_2017)

I_scap_A_col <- aggregate(individualCount ~ plotID + collectDate + site + Year, data=I_scap_A, FUN=sum)
#head(I_scap_A_col, n=20)
#nrow(I_scap_A_col)



```


**Tick pathogens**
```{r}
######### Tick pathogens
tick_path <- tick_path[,c(4,5,7,8,9,14,18,20,23,24)]
#head(tick_path, n=20)
#unique(tick_path$testPathogenName)

# select for LD spirochetes
tick_path_Bb <- tick_path[which(tick_path$testPathogenName == 'Borrelia burgdorferi' | tick_path$testPathogenName == 'Borrelia burgdorferi sensu lato' | tick_path$testPathogenName == 'Borrelia sp.'),]

#nrow(tick_path_Bb)


tick_path_Bb_pos <- tick_path_Bb[which(tick_path_Bb$testResult == 'Positive'),]
#nrow(tick_path_Bb_pos)
#unique(tick_path_Bb_pos$siteID)

### I added these lines 
tick_path_Bm <- tick_path[which(tick_path$testPathogenName == 'Borrelia miyamotoi'),]
tick_path_Bm_pos <- tick_path_Bm[which(tick_path_Bm$testResult == 'Positive'),]
#nrow(tick_path_Bm_pos)
#########################


tick_path_Bb$incidence <- ifelse(tick_path_Bb$testResult == 'Positive', 1, 0)
tick_path_Bb$collectDate <- as.character(tick_path_Bb$collectDate)
tick_path_Bb$Date <- substr(tick_path_Bb$collectDate, 1, nchar(tick_path_Bb$collectDate)-7)
#head(tick_path_Bb)
#nrow(tick_path_Bb)

tick_path_Bb_col <- aggregate(incidence ~ plotID + Date, data=tick_path_Bb, FUN=mean)
#head(tick_path_Bb_col, n=20)
#nrow(tick_path_Bb_col)

tick_path_Bb_col$plotID <- as.character(tick_path_Bb_col$plotID)
tick_path_Bb_col$site <- substr(tick_path_Bb_col$plotID, 1, nchar(tick_path_Bb_col$plotID)-4)
#head(tick_path_Bb_col)

tick_path_Bb_col_E <- tick_path_Bb_col[which(tick_path_Bb_col$site != 'DELA' & tick_path_Bb_col$site != 'KONA' & tick_path_Bb_col$site != 'KONZ' & tick_path_Bb_col$site != 'LENO' & tick_path_Bb_col$site != 'UKFS'),]

#head(tick_path_Bb_col_E)
#nrow(tick_path_Bb_col_E)
#unique(tick_path_Bb_col_E$site)


```


**Mammals**

```{r}

### Mammals:
#head(mams)
#nrow(mams)
#unique(mams$trapStatus)
mamsTrap <- mams[,c(5,6,10,11,16,18,20,21,22,23,29,42,43,44)]
#head(mamsTrap, n=20)
mamsTrap$statusCode <- substr(mamsTrap$trapStatus, 0, 1)
#head(mamsTrap, n=50)

mamsTrap$capture <- ifelse(mamsTrap$statusCode == '5', 1, ifelse(mamsTrap$trapStatus == '4', 1, 0))
#head(mamsTrap)


#unique(mamsTrap$nymphalTicksAttached)
mamsTrap$larvaeYN <- ifelse(mamsTrap$larvalTicksAttached == 'Y', 1, 0)
mamsTrap$nymphsYN <- ifelse(mamsTrap$nymphalTicksAttached == 'Y', 1, 0)
mamsTrap$adultsYN <- ifelse(mamsTrap$adultTicksAttached == 'Y', 1, 0)
#head(mamsTrap)


mamsTrap_captures <- mamsTrap[which(mamsTrap$capture == 1),]
#nrow(mamsTrap_captures)
#head(mamsTrap_captures)

mamsTrap_col <- aggregate(capture ~ plotID + collectDate, data=mamsTrap, FUN=mean)
#nrow(mamsTrap_col)
#head(mamsTrap_col)


mamsTrap_col$site <- substr(mamsTrap_col$plotID, 1, 4)
#head(mamsTrap_col)
#unique(mamsTrap_col$site)


mamsTrap_col_E <- mamsTrap_col[which(mamsTrap_col$site == 'HARV' | mamsTrap_col$site == 'OSBS' | mamsTrap_col$site == 'BART' | mamsTrap_col$site == 'ORNL' | mamsTrap_col$site == 'TALL' | mamsTrap_col$site == 'SCBI' | mamsTrap_col$site == 'UNDE' | mamsTrap_col$site == 'SERC' | mamsTrap_col$site == 'GRSM' | mamsTrap_col$site == 'BLAN' | mamsTrap_col$site == 'TREE' | mamsTrap_col$site == 'STEI' | mamsTrap_col$site == 'MLBS'),]
#unique(mamsTrap_col_E$site)
#nrow(mamsTrap_col_E)

mamsTrap_captures_L_col <- aggregate(larvaeYN ~ plotID + collectDate, data=mamsTrap_captures, FUN=mean)
#nrow(mamsTrap_captures_L_col)
#head(mamsTrap_captures_L_col)
mamsTrap_captures_L_col$site <- substr(mamsTrap_captures_L_col$plotID, 1, 4)
#head(mamsTrap_captures_L_col)
#unique(mamsTrap_captures_L_col$site)

mamsTrap_captures_L_col_E <- mamsTrap_captures_L_col[which(mamsTrap_captures_L_col$site == 'HARV' | mamsTrap_captures_L_col$site == 'OSBS' | mamsTrap_captures_L_col$site == 'BART' | mamsTrap_captures_L_col$site == 'ORNL' | mamsTrap_captures_L_col$site == 'TALL' | mamsTrap_captures_L_col$site == 'SCBI' | mamsTrap_captures_L_col$site == 'UNDE' | mamsTrap_captures_L_col$site == 'SERC' | mamsTrap_captures_L_col$site == 'GRSM' | mamsTrap_captures_L_col$site == 'BLAN' | mamsTrap_captures_L_col$site == 'TREE' | mamsTrap_captures_L_col$site == 'STEI' | mamsTrap_captures_L_col$site == 'MLBS'),]



#unique(mamsTrap_captures_L_col_E$site)
#nrow(mamsTrap_captures_L_col_E)
###View(mamsTrap_captures)

mamsTrap_captures_N_col <- aggregate(nymphsYN ~ plotID + collectDate, data=mamsTrap_captures, FUN=mean)
#nrow(mamsTrap_captures_N_col)
#head(mamsTrap_captures_N_col)

mamsTrap_captures_N_col$site <- substr(mamsTrap_captures_N_col$plotID, 1, 4)
#head(mamsTrap_captures_N_col)
#unique(mamsTrap_captures_N_col$site)

mamsTrap_captures_N_col_E <- mamsTrap_captures_N_col[which(mamsTrap_captures_N_col$site == 'HARV' | mamsTrap_captures_N_col$site == 'OSBS' | mamsTrap_captures_N_col$site == 'BART' | mamsTrap_captures_N_col$site == 'ORNL' | mamsTrap_captures_N_col$site == 'TALL' | mamsTrap_captures_N_col$site == 'SCBI' | mamsTrap_captures_N_col$site == 'UNDE' | mamsTrap_captures_N_col$site == 'SERC' | mamsTrap_captures_N_col$site == 'GRSM' | mamsTrap_captures_N_col$site == 'BLAN' | mamsTrap_captures_N_col$site == 'TREE' | mamsTrap_captures_N_col$site == 'STEI' | mamsTrap_captures_N_col$site == 'MLBS'),]

#unique(mamsTrap_captures_N_col_E$site)
#nrow(mamsTrap_captures_N_col_E)
#head(mamsTrap_captures_N_col_E)
```


Aggregated tick data
```{r aggregated tick data}

# aggregagted larva
I_scap_L_col <- aggregate(individualCount ~ plotID + collectDate + site + Year, data=I_scap_L, FUN=sum)

# aggregated nymph
I_scap_N_col <- aggregate(individualCount ~ plotID + collectDate + site + Year, data=I_scap_N, FUN=sum)

# aggregated adult
I_scap_A_col <- aggregate(individualCount ~ plotID + collectDate + site + Year, data=I_scap_A, FUN=sum)

```



total ticks by site fill by life stage
```{r}

# treat plot ID as character
ticks_taxa$plotID <- lapply(ticks_taxa$plotID, as.character)

# extract certain plots
ticks_taxa$siteID <- substr(ticks_taxa$plotID, 1, nchar(ticks_taxa$plotID)-4)
#head(ticks_taxa)

#plot(ticks_taxa$collectDate, ticks_taxa$individualCount)

# select columns
ticks_taxa2 <- ticks_taxa[,c(3,4,8,23,24,33)]

Iscap <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Larva' | ticks_taxa2$sexOrAge == 'Nymph'),]
                                
Iscap<- Iscap[which(Iscap$scientificName == 'Ixodidae sp.' |
                          Iscap$scientificName == 'Ixodes scapularis' |
                            Iscap$scientificName == 'Ixodidae spp.' |
                            Iscap$scientificName == 'Ixodida sp.' |
                            Iscap$scientificName == 'Ixodes spp.' |
                            Iscap$scientificName == 'Ixodes spp.' |
                            Iscap$scientificName == 'Ixodes pacificus'), ]

unique(Iscap$scientificName)
sapply(Iscap, class)
Iscap$collectDate <- as.character(Iscap$collectDate)

Iscap$collectDate <- substr(Iscap$collectDate, 1, nchar(Iscap$collectDate)-7)
#head(Iscap)

Iscap$collectDate <- as.factor(Iscap$collectDate)
Iscap$plotID <- unlist(Iscap$plotID)
Iscap$collectDate <- as.character(Iscap$collectDate)
Iscap$Year <- substr(Iscap$collectDate, 1, nchar(Iscap$collectDate)-6)
#head(Iscap)


Iscap$Month <- substr(Iscap$collectDate, 6, nchar(Iscap$collectDate)-3)
Iscap$Weeks <- substr(Iscap$collectDate, 6, nchar(Iscap$collectDate))


sitesync <- Iscap  %>%
  group_by(Weeks, site, sexOrAge) %>%
  summarise(sum_counts = sum(individualCount), .groups = 'drop')


#regionnumbers
#names(regionnumbers)[1] <- "Region"
#names(regionnumbers)[2] <- 'Life stage'

#tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)))
#tbl <- tableGrob(regionnumbers, rows=NULL, theme=tt)


 # Keyregions <- Key  %>%
 #  group_by(Weeks, region, sexOrAge) %>%
 #  summarise(sum_counts = sum(individualCount), .groups = 'drop')



# Key$region = factor(Key$region, 
#                              levels = c("northeast",
#                                         "great lakes",
#                                         "midatlantic",
#                                         "praire",
#                                         "southeast",
#                                         "appalachians"),
#                     labels = c("Northeast (L = 2163, N = 569)",
#                                        "Great lakes (L = 2004, N = 885)",
#                                        "Mid Atlantic (L = 13808, N = 1413)",
#                                        "Praire (L = 162760, N = 118)",
#                                        "Southeast (L = 7951, N = 455)",
#                                        "Appalachians (L = 7325, N = 164)"))


  ggplot(sitesync, aes(y = log(sum_counts), x = Weeks, group = sexOrAge, color = sexOrAge, fill =sexOrAge ))+
  geom_density(stat = 'identity', alpha = .6)+
  facet_wrap(~ site, scale = 'free_y', ncol = 2)+
  clean_background  +
  theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5))+
  theme(legend.position = 'bottom', legend.box = 'horizontal')+
  labs(y = 'Log(tick counts) (2016 - 2019)', x = 'Collection Dates')+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 12, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 12))+
  labs(fill = "Life stage")+
   guides(fill = guide_legend(order = 1),color = FALSE)+
    theme(legend.title = element_text(size = 7),legend.text = element_text(size = 7))+
    #scale_x_discrete(breaks = Key$Weeks[c(T,F,F, F, F, F, F, F,F, F, F, F, F,  F, F, F, F, F, F, F)]) +
    theme(legend.position = c(.96, .97))+
    theme(legend.box.margin = margin(0, 0, 0, 0))+
    #geom_vline(xintercept = 10.5, alpha = .3 ) +
    geom_vline(xintercept = 24.5, alpha = .3 ) +
    geom_vline(xintercept = 49.5, alpha = .3 ) +
    geom_vline(xintercept = 74.5, alpha = .3 ) +
    geom_vline(xintercept = 105.5, alpha = .3 ) +
    geom_vline(xintercept = 134.5, alpha = .3 ) +
    geom_vline(xintercept = 160.5, alpha = .3 )+
  annotate(geom = "text", x = 36, y = -.5, label = "May", size = 2) +
  annotate(geom = "text", x = 62, y = -.5, label = "June", size = 2) +
  annotate(geom = "text", x = 91, y = -.5, label = "July", size = 2) +
  annotate(geom = "text", x = 121.7, y = -.5, label = "Aug.", size = 2)+
  annotate(geom = "text", x = 148.7, y = -.5, label = "Sep.", size = 2)
ggsave("geomaregionweeks.pdf", dpi = 320)

```


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*version 4*

total ticks and regions

```{r}

# treat plot ID as character
ticks_taxa$plotID <- lapply(ticks_taxa$plotID, as.character)

# extract certain plots
ticks_taxa$siteID <- substr(ticks_taxa$plotID, 1, nchar(ticks_taxa$plotID)-4)
#head(ticks_taxa)

#plot(ticks_taxa$collectDate, ticks_taxa$individualCount)

# select columns
ticks_taxa2 <- ticks_taxa[,c(3,4,8,23,24,33)]

Iscap <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Larva' | ticks_taxa2$sexOrAge == 'Nymph'),]
                                
Iscap<- Iscap[which(Iscap$scientificName == 'Ixodidae sp.' |
                          Iscap$scientificName == 'Ixodes scapularis' |
                            Iscap$scientificName == 'Ixodidae spp.' |
                            Iscap$scientificName == 'Ixodida sp.' |
                            Iscap$scientificName == 'Ixodes spp.' |
                            Iscap$scientificName == 'Ixodes spp.' |
                            Iscap$scientificName == 'Ixodes pacificus'), ]

unique(Iscap$scientificName)
sapply(Iscap, class)
Iscap$collectDate <- as.character(Iscap$collectDate)

Iscap$collectDate <- substr(Iscap$collectDate, 1, nchar(Iscap$collectDate)-7)
#head(Iscap)

Iscap$collectDate <- as.factor(Iscap$collectDate)
Iscap$plotID <- unlist(Iscap$plotID)
Iscap$collectDate <- as.character(Iscap$collectDate)
Iscap$Year <- substr(Iscap$collectDate, 1, nchar(Iscap$collectDate)-6)
#head(Iscap)


Iscap$Month <- substr(Iscap$collectDate, 6, nchar(Iscap$collectDate)-3)
Iscap$Weeks <- substr(Iscap$collectDate, 6, nchar(Iscap$collectDate))


Iscap$region <- Iscap$site
Iscap$region[Iscap$site == "BART"] <- "northeast"
Iscap$region[Iscap$site == "HARV"] <- "northeast"
Iscap$region[Iscap$site == "BLAN"] <- "midatlantic"
Iscap$region[Iscap$site == "SCBI"] <- "midatlantic"
Iscap$region[Iscap$site == "SERC"] <- "midatlantic" 
Iscap$region[Iscap$site == "STEI"] <- "great lakes"
Iscap$region[Iscap$site == "TREE"] <- "great lakes"
Iscap$region[Iscap$site == "UNDE"] <- "great lakes"
Iscap$region[Iscap$site == "OSBS"] <- "southeast"
Iscap$region[Iscap$site == "KONA"] <- "praire"
Iscap$region[Iscap$site == "KONZ"] <- "praire"
Iscap$region[Iscap$site == "UKFS"] <- "praire"
Iscap$region[Iscap$site == "GRSM"] <- "appalachians"
Iscap$region[Iscap$site == "MLBS"] <- "appalachians"
Iscap$region[Iscap$site == "ORNL"] <- "appalachians"
Iscap$region[Iscap$site == "DELA"] <- "southeast"
Iscap$region[Iscap$site == "LENO"] <- "southeast"
Iscap$region[Iscap$site == "TALL"] <- "southeast"
Iscap$region[Iscap$site == "RMNP"] <- "west"
Iscap$region[Iscap$site == "OAES"] <- "southeast"
Iscap$region[Iscap$site == "ABBY"] <- "west"

keyregions <- Iscap[which(Iscap$region != "west" & Iscap$region != "JORN"), ]


#Weeklycounts <- Iscap  %>%
  #group_by(Weeks, region, sexOrAge) %>%
  #summarise(sum_counts = sum(individualCount), .groups = 'drop')

Key <- keyregions  %>%
  group_by(Weeks, region, sexOrAge) %>%
  summarise(sum_counts = sum(individualCount), .groups = 'drop')

#regionnumbers <- keyregions  %>%
 # group_by(region, sexOrAge) %>%
  #summarise(sum_counts = sum(individualCount), .groups = 'drop')
#View(regionnumbers)

#regionnumbers
#names(regionnumbers)[1] <- "Region"
#names(regionnumbers)[2] <- 'Life stage'

#tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)))
#tbl <- tableGrob(regionnumbers, rows=NULL, theme=tt)


 # Keyregions <- Key  %>%
 #  group_by(Weeks, region, sexOrAge) %>%
 #  summarise(sum_counts = sum(individualCount), .groups = 'drop')



Key$region = factor(Key$region, 
                             levels = c("northeast",
                                        "great lakes",
                                        "midatlantic",
                                        "praire",
                                        "southeast",
                                        "appalachians"),
                    labels = c("Northeast (L = 2163, N = 569)",
                                       "Great lakes (L = 2004, N = 885)",
                                       "Mid Atlantic (L = 13808, N = 1413)",
                                       "Praire (L = 162760, N = 118)",
                                       "Southeast (L = 7951, N = 455)",
                                       "Appalachians (L = 7325, N = 164)"))


#regionale <-
  ggplot(Key, aes(y = log(sum_counts), x = Weeks, group = sexOrAge, color = sexOrAge, fill =sexOrAge ))+
  geom_density(stat = 'identity', alpha = .6)+
  facet_wrap(~ region, scale = 'free_y', ncol = 2)+
  clean_background  +
  theme(axis.text.x = element_text(angle = 90, size = 4, vjust = 0.5))+
  theme(legend.position = 'bottom', legend.box = 'horizontal')+
  labs(y = 'Log(tick counts) (2016 - 2019)', x = 'Collection Dates')+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  theme(axis.title.y =  element_text(face = 'bold',size = 12, vjust = .5))+
  theme(axis.title.x =  element_text(face = 'bold',size = 12))+
  labs(fill = "Life stage")+
   guides(fill = guide_legend(order = 1),color = FALSE)+
    theme(legend.title = element_text(size = 7),legend.text = element_text(size = 7))+
    #scale_x_discrete(breaks = Key$Weeks[c(T,F,F, F, F, F, F, F,F, F, F, F, F,  F, F, F, F, F, F, F)]) +
    theme(legend.position = c(.96, .97))+
    theme(legend.box.margin = margin(0, 0, 0, 0))+
    #geom_vline(xintercept = 10.5, alpha = .3 ) +
    geom_vline(xintercept = 24.5, alpha = .3 ) +
    geom_vline(xintercept = 49.5, alpha = .3 ) +
    geom_vline(xintercept = 74.5, alpha = .3 ) +
    geom_vline(xintercept = 105.5, alpha = .3 ) +
    geom_vline(xintercept = 134.5, alpha = .3 ) +
    geom_vline(xintercept = 160.5, alpha = .3 )+
  annotate(geom = "text", x = 36, y = -.5, label = "May", size = 2) +
  annotate(geom = "text", x = 62, y = -.5, label = "June", size = 2) +
  annotate(geom = "text", x = 91, y = -.5, label = "July", size = 2) +
  annotate(geom = "text", x = 121.7, y = -.5, label = "Aug.", size = 2)+
  annotate(geom = "text", x = 148.7, y = -.5, label = "Sep.", size = 2)
ggsave("geomaregionweeks.pdf", dpi = 320)


#ggarrange(regionale, tbl)


    #guide_legend(title="Life stage")
  #scale_fill_manual(legend_title,values=c("orange","red"))
  #guides(fill=guide_legend(title="Life stage"))


```



larval by week
```{r}
#library(tidyverse)
#larve
I_scap_L <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Larva' & ticks_taxa2$scientificName == 'Ixodidae sp.' |
                          ticks_taxa2$scientificName == 'Ixodes scapularis' |
                            ticks_taxa2$scientificName == 'Ixodidae spp.' |
                            ticks_taxa2$scientificName == 'Ixodida sp.' |
                            ticks_taxa2$scientificName == 'Ixodes spp.' |
                            ticks_taxa2$scientificName == 'Ixodes spp.' |
                            ticks_taxa2$scientificName == 'Ixodes pacificus'), ]

unique(I_scap_L$scientificName)
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_L, class)
I_scap_L$collectDate <- as.character(I_scap_L$collectDate)

I_scap_L$collectDate <- substr(I_scap_L$collectDate, 1, nchar(I_scap_L$collectDate)-7)
#head(I_scap_N)

I_scap_L$collectDate <- as.factor(I_scap_L$collectDate)
I_scap_L$plotID <- unlist(I_scap_L$plotID)
I_scap_L$collectDate <- as.character(I_scap_L$collectDate)
I_scap_L$Year <- substr(I_scap_L$collectDate, 1, nchar(I_scap_L$collectDate)-6)
#head(I_scap_N)

I_scap_L$Month <- substr(I_scap_L$collectDate, 6, nchar(I_scap_L$collectDate)-3)
I_scap_L$Weeks <- substr(I_scap_L$collectDate, 6, nchar(I_scap_L$collectDate))

weeklycounts <- I_scap_L  %>%
  group_by(Weeks, site) %>%
  summarise(sum_countsL = sum(individualCount), .groups = 'drop')

monthlycounts <- I_scap_L  %>%
  group_by(Month, site) %>%
  summarise(sum_countsL = sum(individualCount), .groups = 'drop')
View(monthlycounts)

sitecounts <- I_scap_L  %>%
  group_by(site) %>%
  summarise(sum_countsL = sum(individualCount), .groups = 'drop')
View(sitecounts)

newsites <- sitecounts[which(sitecounts$sum_countsL > 10), ]

newsitesE<- weeklycounts[which(weeklycounts$site == 'HARV' | weeklycounts$site == 'BLAN' | weeklycounts$site == 'SCBI' | weeklycounts$site == 'SERC' | weeklycounts$site == 'OSBS' | weeklycounts$site == 'STEI' | weeklycounts$site == 'TREE' | weeklycounts$site == 'UNDE' | weeklycounts$site == 'GRSM' | weeklycounts$site == 'MLBS' | weeklycounts$site == 'ORNL' | weeklycounts$site == 'TALL' | weeklycounts$site == 'KONZ' | weeklycounts$site == 'LENO' |weeklycounts$site == 'OAES' | weeklycounts$site == 'TALL'), ]

newsitesEE<- weeklycounts[which(weeklycounts$site == 'HARV' | weeklycounts$site == 'BLAN' | weeklycounts$site == 'SCBI' | weeklycounts$site == 'SERC' | weeklycounts$site == 'OSBS' | weeklycounts$site == 'STEI' | weeklycounts$site == 'TREE' | weeklycounts$site == 'ORNL' | weeklycounts$site == 'TALL'), ]


newsitesEE<- newsitesEE[which(newsitesEE$Weeks > "05-02"), ]
View(newsitesEE)
## put into regions
newsitesEE$region <- newsitesEE$site
newsitesEE$region[newsitesEE$site == "HARV"] <- "northeast"
newsitesEE$region[newsitesEE$site == "BLAN"] <- "midatlantic"
newsitesEE$region[newsitesEE$site == "SCBI"] <- "midatlantic"
newsitesEE$region[newsitesEE$site == "SERC"] <- "midatlantic" 
newsitesEE$region[newsitesEE$site == "STEI"] <- "great lakes"
newsitesEE$region[newsitesEE$site == "TREE"] <- "great lakes"
newsitesEE$region[newsitesEE$site == "OSBS"] <- "southeast"
newsitesEE$region[newsitesEE$site == "ORNL"] <- "southeast"
newsitesEE$region[newsitesEE$site == "TALL"] <- "southeast"
View(newsitesEE)

ggplot(newsitesE, aes(y = sum_countsL, x = Weeks, group = site, color = site))+
  #geom_smooth(se = FALSE)+
  geom_area(aes(fill = site), alpha = .5)+
#aes(fill = site),alpha = .8)+
  clean_background  +
  coord_cartesian(ylim = c(0,1550))+
  theme(axis.text.x = element_text(angle = 90, size = 6, vjust = 0.5))+
    theme(legend.position = 'bottom', legend.box = 'horizontal')

## regional
ggplot(newsitesEE, aes(y = sum_countsL, x = Weeks, group = region, color = region))+
  #geom_smooth(se = FALSE)+
  geom_area(position = 'stack', aes(fill = region), alpha = .5)+
#aes(fill = site),alpha = .8)+
  clean_background  +
  coord_cartesian(ylim = c(0,1500))+
  theme(axis.text.x = element_text(angle = 90, size = 6, vjust = 0.5))+
    theme(legend.position = 'bottom', legend.box = 'horizontal')+
  #scale_x_discrete(expand = c(0,0)) +
  theme(axis.text.x=element_text(size=6))




ggplot(monthlycounts, aes(y = sum_countsL, x = Month, group = site, color = site))+
  #geom_smooth(se = FALSE)+
  geom_area(aes(fill = site), alpha = .5)+
#aes(fill = site),alpha = .8)+
  clean_background 

```


nymphs by week 

```{r completed geom area}
#Nymphs
I_scap_N <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Nymph' & ticks_taxa2$scientificName == 'Ixodes scapularis'),]
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_N, class)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)

I_scap_N$collectDate <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-7)
#head(I_scap_N)

I_scap_N$collectDate <- as.factor(I_scap_N$collectDate)
I_scap_N$plotID <- unlist(I_scap_N$plotID)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)
I_scap_N$Year <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-6)
#head(I_scap_N)

I_scap_N$Month <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate)-3)
I_scap_N$Weeks <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate))

collected <- I_scap_N %>%
  group_by(Weeks, site) %>%
  summarise(sum_counts = sum(individualCount), .groups = 'drop')
View(collected)

collected <- collected[which(collected$site == 'HARV' |
                                       collected$site == 'SCBI' |
                               collected$site == 'ORNL'),]
collected$site = factor(collected$site, 
                            levels = c('HARV',
                                       'SCBI',
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'SCBI - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))

ggplot(collected, aes(y = sum_counts, x = Weeks, group = site, color = site))+
  #geom_smooth(se = FALSE)+
  geom_area(position = 'stack', aes(fill = site), alpha = .8)+
#aes(fill = site),alpha = .8)+
  clean_background +
  geom_vline(xintercept = 5.5, alpha = .3, ) +
  geom_vline(xintercept = 21.5, alpha = .3, ) +
  geom_vline(xintercept = 40.5, alpha = .3, ) +
  geom_vline(xintercept = 60.5, alpha = .3, ) +
  geom_vline(xintercept = 77.5, alpha = .3, ) +
  geom_vline(xintercept = 88.5, alpha = .3, ) +
  labs(y = 'Summed nymph counts\n (2016 - 2019)', x = 'Collection Dates') +
  #labs(fill = "Site")+
  theme(axis.title.y =  element_text(face = 'bold',size = 12))+
  theme(axis.title.x =  element_text(face = 'bold',size = 12))+
  #scale_x_continuous(breaks = round(seq(min(collected$Month), max(collected$Month))))+
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0))) +
  theme(legend.position = c(.75, .7))+
  #theme(legend.position = 'bottom', legend.box = 'horizontal')+
  theme(axis.text.x = element_text(angle = 90, size = 6, vjust = 0.5))+
  annotate(geom = "text", x = 9, y = 80, label = "May", size = 3.5) + 
  annotate(geom = "text", x = 25, y = 80, label = "June", size = 3.5) +
  annotate(geom = "text", x = 44, y = 80, label = "July", size = 3.5)+
  annotate(geom = "text", x = 65, y = 80, label = "August", size = 3.5)+
  annotate(geom = "text", x = 83, y = 80, label = "September", size = 3.5)
ggsave("geomareanymphweeks.pdf", dpi = 320)

  

```




~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*version 3 on 10/2/20*

  

```{r}
#Nymphs
I_scap_N <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Nymph' & ticks_taxa2$scientificName == 'Ixodes scapularis'),]
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_N, class)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)

I_scap_N$collectDate <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-7)
#head(I_scap_N)

I_scap_N$collectDate <- as.factor(I_scap_N$collectDate)
I_scap_N$plotID <- unlist(I_scap_N$plotID)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)
I_scap_N$Year <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-6)
#head(I_scap_N)

I_scap_N$Month <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate)-3)
I_scap_N$Weeks <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate))
#View(I_scap_N)
I_scap_N <- I_scap_N[which(I_scap_N$Month < "4"),]

#I_scap_N_col$Month <- substr(I_scap_N_col$collectDate, 6, nchar(I_scap_N_col$collectDate)-3)

#boop <- aggregate(individualCount ~ site, Year, Month, data = I_scap_N)
#library(lubridate)

ymd(I_scap_N$collectDate)
# View(I_scap_N)
I_scap_N <- I_scap_N[which(I_scap_N$site == 'HARV' |
                                       I_scap_N$site == 'ORNL' |
                                I_scap_N$site == 'BLAN' |
                                      I_scap_N$site == 'SCBI' |
                                I_scap_N$site == 'SERC'),]

# I_scap_N_col <- I_scap_N_col[which(I_scap_N_col$site == 'HARV' |
#                                        I_scap_N_col$site == 'ORNL' |
#                                 I_scap_N_col$site == 'BLAN' |
#                                       I_scap_N_col$site == 'SCBI' |
#                                 I_scap_N_col$site == 'SERC'),]
# 


# reorder sites from north to south
I_scap_N$site = factor(I_scap_N$site, 
                            levels = c('HARV',
                                       'TREE',
                                       'BLAN',
                                       'SCBI',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'TREE - GREAT LAKES',
                                       'BLAN - MID ATLANTIC',
                                       'SCBI - MID ATLANTIC',
                                       'SERC - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))


# geom smooth = lm
# Not helpful for phenology
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.numeric(Month)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   geom_point() +
#   geom_smooth(method="lm")+
#   clean_background


# geom smooth = loess, geom_smooth
# not as strong of plots
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.numeric(Month)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   geom_point() +
#   geom_smooth(method="loess", span = 1)+
#   clean_background

# # geom smooth = loess, stat_smooth
# geom smooth looks nicer
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.numeric(Month)))+
#   facet_wrap(~ site, scale = 'free_y')+
#   geom_point() +
#   stat_smooth()+
#   clean_background

I_scap_N$Month <-month(as.POSIXlt(I_scap_N$collectDate, format = "%Y-%m- %d"))

class(I_scap_N$Month)




noharv <- I_scap_N[!(I_scap_N$site== "HARV - NORTHEAST" & I_scap_N$Month=="4"),]
noharv <- noharv[which(noharv$site == 'HARV - NORTHEAST' |
                         noharv$site == 'ORNL - APPALACHIANS' |
                         noharv$site == 'SCBI - MID ATLANTIC'),]
noharv$site = factor(noharv$site, 
                            levels = c('ORNL - APPALACHIANS',
                                       'SCBI - MID ATLANTIC',
                                       'HARV - NORTHEAST'),
                            labels = c('ORNL - APPALACHIANS',
                                       'SCBI - MID ATLANTIC',
                                       'HARV - NORTHEAST'))


# Weighted geom smooth = loess, wiggly 
ggplot(data = noharv,
aes(y = individualCount, x = Month))+
  facet_wrap(~ site, scale = 'free_y', ncol = 3)+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red',aes(weight = individualCount), span = .7, size = 1.5)+
    stat_smooth(geom='ribbon', aes(weight = individualCount,ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  clean_background +
  coord_cartesian(xlim = c(3, 9))+
  geom_vline(xintercept = 6)+
  labs(y = 'Total ticks per sampling \n (2016 - 2019)', x = 'Collection Month') +
  theme(axis.title.y =  element_text(face = 'bold',size = 12, color = 'black')) +
  theme(axis.title.x =  element_text(face = 'bold',size = 12, color = 'black'))
ggsave("geomnymphfinal.pdf", dpi = 320)


  #scale_y_continuous(expand = c(0, 0), limits = c(0, max(individualCount))) 


# # Weighted geom smooth = loess, medium wiggly 
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.character.Date(Month)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   geom_point() +
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
#   geom_smooth(method="loess", aes(weight = individualCount),
#              size = 1.5, color = 'red',
#               span = .7, se = FALSE)+
#   clean_background
# 

# # Weighted geom smooth = loess, no wiggle
# some wiggle makes peaks more pronounced
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.numeric(Month)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   geom_point() +
#   geom_smooth(method="loess",aes(weight = individualCount), 
#               size = 1.5, color = 'red',
#               span = 1, se = FALSE)+
#   clean_background
```

weeks
```{r completed geom area}
#Nymphs
I_scap_N <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Nymph' & ticks_taxa2$scientificName == 'Ixodes scapularis'),]
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_N, class)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)

I_scap_N$collectDate <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-7)
#head(I_scap_N)

I_scap_N$collectDate <- as.factor(I_scap_N$collectDate)
I_scap_N$plotID <- unlist(I_scap_N$plotID)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)
I_scap_N$Year <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-6)
#head(I_scap_N)

I_scap_N$Month <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate)-3)
I_scap_N$Weeks <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate))

collected <- I_scap_N %>%
  group_by(Weeks, site) %>%
  summarise(sum_counts = sum(individualCount), .groups = 'drop')
View(collected)

collected <- collected[which(collected$site == 'HARV' |
                                       collected$site == 'SCBI' |
                               collected$site == 'ORNL'),]
collected$site = factor(collected$site, 
                            levels = c('HARV',
                                       'SCBI',
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'SCBI - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))

ggplot(collected, aes(y = sum_counts, x = Weeks, group = site, color = site))+
  #geom_smooth(se = FALSE)+
  geom_area(position = 'stack', aes(fill = site), alpha = .8)+
#aes(fill = site),alpha = .8)+
  clean_background +
  geom_vline(xintercept = 5.5, alpha = .3, ) +
  geom_vline(xintercept = 21.5, alpha = .3, ) +
  geom_vline(xintercept = 40.5, alpha = .3, ) +
  geom_vline(xintercept = 60.5, alpha = .3, ) +
  geom_vline(xintercept = 77.5, alpha = .3, ) +
  geom_vline(xintercept = 88.5, alpha = .3, ) +
  labs(y = 'Summed nymph counts\n (2016 - 2019)', x = 'Collection Dates') +
  #labs(fill = "Site")+
  theme(axis.title.y =  element_text(face = 'bold',size = 12))+
  theme(axis.title.x =  element_text(face = 'bold',size = 12))+
  #scale_x_continuous(breaks = round(seq(min(collected$Month), max(collected$Month))))+
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 15, b = 0, l = 0))) +
  theme(legend.position = c(.75, .7))+
  #theme(legend.position = 'bottom', legend.box = 'horizontal')+
  theme(axis.text.x = element_text(angle = 90, size = 6, vjust = 0.5))+
  annotate(geom = "text", x = 9, y = 80, label = "May", size = 3.5) + 
  annotate(geom = "text", x = 25, y = 80, label = "June", size = 3.5) +
  annotate(geom = "text", x = 44, y = 80, label = "July", size = 3.5)+
  annotate(geom = "text", x = 65, y = 80, label = "August", size = 3.5)+
  annotate(geom = "text", x = 83, y = 80, label = "September", size = 3.5)
ggsave("geomareanymphweeks.pdf", dpi = 320)

  

```


geom_area
```{r}

  
  
#I_scap_N$weeknumber <-strftime(I_scap_N$collectDate, format = " %V")


boop <- I_scap_N %>%
  group_by(Month, site)%>%
  summarise(sum_counts = sum(individualCount), .groups = 'drop')
View(boop)

#boop <- boop[which(boop$Month > "03"),]

#month(as.POSIXlt(boop$collectDate, format = "%Y-%m- %d"))
boop <- boop[which(boop$site == 'HARV' |
                     boop$site == 'BLAN' |
                     boop$site == 'ORNL' |
                     boop$site == 'SERC' |
                     boop$site == 'SCBI'),]

boop$site = factor(boop$site, 
                            labels = c('HARV - NORTHEAST',
                                       'BLAN - MID ATLANTIC',
                                       'SERC - MID ATLANTIC',
                                       'SCBI - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))

#boop$Month <- as.numeric(boop$Month)

#class(boop$Month)
#as.Date.numeric(boop$Month)
# Weighted stat smooth = loess
ggplot(data = boop,
aes(y = sum_counts, x = Month))+
  #facet_wrap(~ site, nrow = 3, scale = 'free_y')+
  #geom_point() +
  #geom_line(lineend = "round", linejoin = "round")+
  geom_area(aes(fill = site, group = site), alpha = .9)+
  clean_background +
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  labs(y = 'Summed nymph counts\n (2016 - 2019)') +
  labs(fill = "Site")+
  theme(axis.title.y =  element_text(face = 'bold',size = 12)) +
  theme(axis.title.x =  element_text(face = 'bold',size = 12)) +
  geom_vline(xintercept = 04)
  #theme(legend.position = 'bottom', legend.box = 'horizontal')


```

```{r extra plots}
 #library(mgcv) 
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.Date(collectDate)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   geom_point() +
#   geom_line()+
#   clean_background

# # geom smooth = gam
# essentially looks the same as loess
# ggplot(data = I_scap_N,
# aes(y = individualCount, x = as.numeric(Month)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   geom_point() +
#   geom_smooth(method="gam", formula = y ~s(x))+
#   stat_smooth()+
#   clean_background
  
# geom smooth = ribbon
# 
# ggplot(data = I_scap_N,
#          aes(y = individualCount, x = as.numeric(Month)))+
#   facet_wrap(~ site, scale = 'free_y' )+
#   theme(strip.background = element_rect(fill = 'gray95'))+
#   theme(strip.text.x = element_text(face = 'bold'))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
#   clean_background +
#   rotatexaxistheme +
#   multiplottitletheme+
#   ytitletheme +
#   xtitletheme +
#   labs(x = "Collection Date",y = 'Questing tick counts')
  

```


incidence

```{r}
# extract Year
tick_path_Bb_col_E$Year <- substr(tick_path_Bb_col_E$Date, 1, nchar(tick_path_Bb_col_E$Date)-6)
# extract Month
tick_path_Bb_col_E$Month <- substr(tick_path_Bb_col_E$Date, 6, nchar(tick_path_Bb_col_E$Date)-3)


incidence_2 <- tick_path_Bb_col_E[which(tick_path_Bb_col_E$site == 'HARV' |
                                          tick_path_Bb_col_E$site == 'SCBI' |
                                         tick_path_Bb_col_E$site == 'ORNL'),]

incidence_2$site = factor(incidence_2$site, 
                            levels = c('HARV',
                                       'SCBI',
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'SCBI - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))


#View(incidence_2)

ggplot(incidence_2, aes(y = incidence, x = Month))+
  facet_wrap(~site, nrow = 3, scale = 'free_y')+
  geom_boxplot(fill = 'gray')+
  clean_background +
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold')) +
  labs(y = 'Summed nymph counts\n (2016 - 2019)') +
  theme(axis.title.y =  element_text(face = 'bold',size = 12)) +
  theme(axis.title.x =  element_text(face = 'bold',size = 12)) 

```


geom_bar plotID
```{r}
#Nymphs
I_scap_N <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Nymph' & ticks_taxa2$scientificName == 'Ixodes scapularis'),]
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_N, class)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)

I_scap_N$collectDate <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-7)
#head(I_scap_N)

I_scap_N$collectDate <- as.factor(I_scap_N$collectDate)
I_scap_N$plotID <- unlist(I_scap_N$plotID)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)
I_scap_N$Year <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-6)
#head(I_scap_N)

I_scap_N$Month <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate)-3)
I_scap_N$Weeks <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate))

tick_path_Bb_col_E$site = factor(tick_path_Bb_col_E$plotID, 
                            levels = c("HARV_001",
                                       "HARV_002",
                                       "HARV_004",
                                       "HARV_006",
                                       "HARV_020" ,
                                       "HARV_022", 
                                       "HARV_026" ,
                                       "TREE_007",
                                       "TREE_015",
                                       "TREE_017",
                                       "TREE_019",
                                       "TREE_022",
                                       "BLAN_005",
                                       "BLAN_012",
                                       "SERC_001",
                                       "SERC_002",
                                       "SERC_005",
                                       "SERC_006",
                                       "SERC_012",
                                       "SERC_023",
                                       "SCBI_002",
                                       "SCBI_005",
                                       "SCBI_006",
                                       "SCBI_007",
                                       "SCBI_013",
                                       "SCBI_039",
                                       "ORNL_002",
                                       "ORNL_003",
                                       "ORNL_007",
                                       "ORNL_008",
                                       "ORNL_009",
                                       "ORNL_040")) 
                                       


totalticks <- aggregate(individualCount ~ site, data=I_scap_N, FUN=sum)
names(totalticks)[1] <- "Site"
names(totalticks)[2] <- 'Total ticks'

```

```{r}

#Nymphs
I_scap_N <- ticks_taxa2[which(ticks_taxa2$sexOrAge == 'Nymph' & ticks_taxa2$scientificName == 'Ixodes scapularis'),]
#head(I_scap_N)
#nrow(I_scap_N)
sapply(I_scap_N, class)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)

I_scap_N$collectDate <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-7)
#head(I_scap_N)

I_scap_N$collectDate <- as.factor(I_scap_N$collectDate)
I_scap_N$plotID <- unlist(I_scap_N$plotID)
I_scap_N$collectDate <- as.character(I_scap_N$collectDate)
I_scap_N$Year <- substr(I_scap_N$collectDate, 1, nchar(I_scap_N$collectDate)-6)
#head(I_scap_N)

I_scap_N$Month <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate)-3)
I_scap_N$Weeks <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate))


totalticks$Site = factor(totalticks$Site, 
                            levels = c("HARV",
                                       "TREE",
                                       "BLAN",
                                       "SERC",
                                       "SCBI",
                                       "ORNL"),
                         labels = c("HARV",
                                       "TREE",
                                       "BLAN",
                                       "SERC",
                                       "SCBI",
                                       "ORNL")) 

totalticks   <- subset(totalticks, !is.na(Site))                           
                                    
 #ggplot(as.data.frame(totalticks), aes(x = Site, y = individualCount))+
  # geom_point()
 



#d <- tableGrob(totalticks, rows = rownames(totalticks), cols = colnames(totalticks))
#grid.arrange(d)
#myt <- ttheme_default(
         # Use hjust and x to left justify the text
         # Alternate the row fill colours
                 #core = list(fg_params=list(hjust = 1, x=1),
                             #bg_params=list(fill=c("grey90", "grey88"))))
#c <-grid.draw(tableGrob(format(totalticks, big.mark=","), theme=myt, rows=NULL))

tt <- ttheme_default(colhead=list(fg_params = list(parse=TRUE)))
tbl <- tableGrob(totalticks, rows=NULL, theme=tt)

#library(cowplot)

#ggplot(totalticks, aes(y = individualCount, x = plotID))+
  #geom_point()                                      
                                       
# remove NA                                     
tick_path_Bb_col_E   <- subset(tick_path_Bb_col_E, !is.na(plotID))                           

ggplot(tick_path_Bb_col_E, aes(x = incidence, y = plotID))+
         geom_boxplot(fill = 'gray91', na.rm = TRUE)+
  scale_y_discrete(limits = rev(levels(tick_path_Bb_col_E$plotID)))+
  clean_background +
  theme(axis.text.y = element_text(size = 5.7, vjust = 0.9))+
  titleytheme +
  geom_hline(yintercept = c(6.4, 12.4, 18.4, 25.4),color = 'red', size = .4, alpha = .3)+
  labs(x = "B. burgdorferi incidence", y = "SiteID") +
  scale_x_continuous(expand = c(0, 0), limits = c(0, 1.04)) +
  xtitletheme +
  annotation_custom(tbl, xmin = .75, ymax = 11)
ggsave("bbincidenceboxplotwithtable.pdf", dpi = 320)


#ggarrange(x,tbl,
          #widths = c(1, .3),
         # heights = c(1,.5,.3)) 

  # annotate(geom = "text", x = .9, y = 37.1, label = "NORTHEAST", size = 3.5, color = 'red')+
  # annotate(geom = "text", x = .9, y = 27.7, label = "GREAT LAKES", size = 3.5, color = 'red') +
  # annotate(geom = "text", x = .9, y = 24.35, label = "MID ATLANTIC", size = 3.5, color = 'red') +
  # annotate(geom = "text", x = .9, y = 20.35, label = "MID ATLANTIC", size = 3.5, color = 'red') +
  # annotate(geom = "text", x = .9, y = 14.35, label = "MID ATLANTIC", size = 3.5, color = 'red') +
  # annotate(geom = "text", x = .9, y = 8.35, label = "APPALACHIANS", size = 3.5, color = 'red') +
  # annotate(geom = "text", x = .9, y = 3.35, label = "SOUTHEAST", size = 3.5, color = 'red')
  # 

ggplot(tick_path_Bb_col_E, aes(incidence))+
         geom_histogram(,fill = 'gray91', na.rm = TRUE)+
    scale_x_discrete(limits = rev(levels(tick_path_Bb_col_E$plotID)))+
  clean_background + 
  coord_flip()


#unique(tick_path_Bb_col_E$site)
```


```{r}

tick_path_Bb_col_E$countt <-aggregate(individualCount ~ plotID, data=I_scap_N, FUN=sum)

unique(totalticks$site)
ggplot(totalticks, aes(y = individualCount, x = site))+
  geom_point()
```



~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


*version 2 on 9/29/20*

## Graph type 1b

*Geom smooth lines for questing nymphs at sites per year*

+ I tried to arrange from north to south sites

+ BLAN has some weird bimodal stuff going on, ORNL has strong bimodal peaks which is interesting

```{r graph type 2 updated}

## NYMPHS


# 2016
I_scap_N_2016 <- I_scap_N[which(I_scap_N$Year == '2016'), ]
I_scap_N_2016 <- I_scap_N_2016[which(I_scap_N_2016$site == 'ORNL' |
                                I_scap_N_2016$site == 'SCBI' |
                                I_scap_N_2016$site == 'SERC'),]
# could have kept BLAN but it's neater without it
# reorder sites from north to south

# for some reson this is fucking up the dataframe
# I_scap_N_2016$site = factor(I_scap_N_2016$site, 
#                             levels = c('SCBI',
#                                        'SERC', 
#                                        'ORNL'),
#                             labels = c('SCBI - MID ATLANTIC',
#                                        'SERC - MID ATLANTIC',
#                                        'ORNBL - APPALACHIANS'))
#str(I_scap_N_2016$Month)
I_scap_N_2016 <- I_scap_N_2016[which(I_scap_N_2016$Month < "09"),]
I_scap_N_2016 <- I_scap_N_2016[which(I_scap_N_2016$Month > "03"),]
View(I_scap_N_2016)

#unique(I_scap_N_2016$site)
# point and line
N2016 <- ggplot(data = I_scap_N_2016,
aes(y = individualCount, x = as.Date(collectDate)))+
  facet_wrap(~site, scale = 'free_y',ncol = 2)+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2016)",y = 'Questing tick counts')
  
N2016  
ggsave("geomnymph2016.pdf", dpi = 320)

##2017

I_scap_N_2017 <- I_scap_N[which(I_scap_N$Year == '2017'),]
I_scap_N_2017 <- I_scap_N_2017[which(I_scap_N_2017$Month < "09"),]
I_scap_N_2017 <- I_scap_N_2017[which(I_scap_N_2017$site == 'HARV' |
                                       I_scap_N_2017$site == 'ORNL' |
                                I_scap_N_2017$site == 'SCBI' |
                                I_scap_N_2017$site == 'SERC' |
                                I_scap_N_2017$site == 'TREE'),]
# could have kept BLAN but it's neater without it
# reorder sites from north to south
I_scap_N_2017$site = factor(I_scap_N_2017$site, 
                            levels = c('HARV',
                                       'TREE',
                                       'SCBI',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('TREE - GREAT LAKES',
                                       'HARV - NORTHEAST',
                                       'SCBI - MID ATLANTIC',
                                       'SERC - MID ATLANTIC',
                                       'ORNBL - APPALACHIANS'))


N2017 <- ggplot(data = I_scap_N_2017,
aes(y = individualCount, x = as.Date(collectDate)))+
  facet_wrap(~site, scale = 'free_y',ncol = 2)+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2017)",y = 'Questing tick counts')
N2017
ggsave("geomnymph2017.pdf", dpi = 320)

# 2018
I_scap_N_2018 <- I_scap_N[which(I_scap_N$Year == '2018'),]
I_scap_N_2018 <- I_scap_N_2018[which(I_scap_N_2018$Month < "09"),]

I_scap_N_2018 <- I_scap_N_2018[which(I_scap_N_2018$site == 'HARV' |
                                       I_scap_N_2018$site == 'ORNL' |
                                I_scap_N_2018$site == 'BLAN' |
                                      I_scap_N_2018$site == 'SCBI' |
                                I_scap_N_2018$site == 'SERC' |
                                I_scap_N_2018$site == 'TREE'),]
# could have kept BLAN but it's neater without it
# reorder sites from north to south
I_scap_N_2018$site = factor(I_scap_N_2018$site, 
                            levels = c('HARV',
                                       'TREE',
                                       'BLAN',
                                       'SCBI',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'TREE - GREAT LAKES',
                                       'BLAN - MID ATLANTIC',
                                       'SCBI - MID ATLANTIC',
                                       'SERC - MID ATLANTIC',
                                       'ORNBL - APPALACHIANS'))



N2018 <- ggplot(data = I_scap_N_2018,
aes(y = individualCount, x = as.Date(collectDate)))+
  facet_wrap(~site, scale = 'free_y',ncol = 2)+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2018)",y = 'Questing tick counts')
N2018
ggsave("geomnymph2018.pdf", dpi = 320)


# 2019
I_scap_N_2019 <- I_scap_N[which(I_scap_N$Year == '2019'),]
I_scap_N_2019 <- I_scap_N_2019[which(I_scap_N_2019$Month < "09"),]

I_scap_N_2019 <- I_scap_N_2019[which(I_scap_N_2019$site == 'HARV' |
                                       I_scap_N_2019$site == 'ORNL' |
                                I_scap_N_2019$site == 'BLAN' |
                                      I_scap_N_2019$site == 'SCBI' |
                                I_scap_N_2019$site == 'SERC' |
                                I_scap_N_2019$site == 'TREE'),]

# reorder sites from north to south
I_scap_N_2019$site = factor(I_scap_N_2019$site, 
                            levels = c('HARV',
                                       'TREE',
                                       'BLAN',
                                       'SCBI',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'TREE - GREAT LAKES',
                                       'BLAN - MID ATLANTIC',
                                       'SCBI - MID ATLANTIC',
                                       'SERC - MID ATLANTIC',
                                       'ORNBL - APPALACHIANS'))


N2019 <- ggplot(data = I_scap_N_2019,
aes(y = individualCount, x = as.Date(collectDate)))+
  facet_wrap(~site, scale = 'free_y',ncol = 2)+
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2019)",y = 'Questing tick counts')
N2019
ggsave("geomnymph2019.pdf", dpi = 320)

```




## Graph 2

**B. burgdorferi incidence by region in questing ticks**


```{r bb incidence geom smooth}

## corral right year, month

# extract Year
tick_path_Bb_col_E$Year <- substr(tick_path_Bb_col_E$Date, 1, nchar(tick_path_Bb_col_E$Date)-6)
# extract Month
tick_path_Bb_col_E$Month <- substr(tick_path_Bb_col_E$Date, 6, nchar(tick_path_Bb_col_E$Date)-3)

tick_path_Bb_col_E <- tick_path_Bb_col_E[which(tick_path_Bb_col_E$Month < "09"),]
tick_path_Bb_col_E <- tick_path_Bb_col_E[which(tick_path_Bb_col_E$Month > "03"),]



## 2016

tick_path_Bb_col_E_2016 <- tick_path_Bb_col_E[which(tick_path_Bb_col_E$Year == '2016'), ]
# extract relevant sitees
tick_path_Bb_col_E_2016 <- tick_path_Bb_col_E_2016[which(tick_path_Bb_col_E_2016$site == 'TREE' |
                                       tick_path_Bb_col_E_2016$site == 'SERC' |
                                tick_path_Bb_col_E_2016$site == 'ORNL'), ]


# reorder sites from north to south
tick_path_Bb_col_E_2016$site = factor(tick_path_Bb_col_E_2016$site, 
                            levels = c('TREE',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('TREE - GREAT LAKES',
                                       'SERC - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))



P2016 <- ggplot(data = tick_path_Bb_col_E_2016,
aes(y = incidence, x = as.Date(Date)))+
  facet_wrap(~site, ncol = 1)+ # add scale = 'free_y', if you want to see some close up data
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2016)",y = 'B. burgdorferi incidence')
P2016  

ggsave("geombbincidence2016.pdf", dpi = 320)

## 2017

tick_path_Bb_col_E_2017 <- tick_path_Bb_col_E[which(tick_path_Bb_col_E$Year == '2017'), ]


# extract relevant sitees
tick_path_Bb_col_E_2017 <- tick_path_Bb_col_E_2017[which(tick_path_Bb_col_E_2017$site == 'TREE' |
                                       tick_path_Bb_col_E_2017$site == 'SERC' |
                                tick_path_Bb_col_E_2017$site == 'ORNL'), ]


# reorder sites from north to south
tick_path_Bb_col_E_2017$site = factor(tick_path_Bb_col_E_2017$site, 
                            levels = c('TREE',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('TREE - GREAT LAKES',
                                       'SERC - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))



P2017 <- ggplot(data = tick_path_Bb_col_E_2017,
aes(y = incidence, x = as.Date(Date)))+
  facet_wrap(~site, ncol = 1)+ # add scale = 'free_y', if you want to see some close up data
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2017)",y = 'B. burgdorferi incidence')
P2017
ggsave("geombbincidence2017.pdf", dpi = 320)


## 2018

tick_path_Bb_col_E_2018 <- tick_path_Bb_col_E[which(tick_path_Bb_col_E$Year == '2018'), ]


# extract relevant sitees
tick_path_Bb_col_E_2018 <- tick_path_Bb_col_E_2018[which(tick_path_Bb_col_E_2018$site == 'HARV' |
                                                        tick_path_Bb_col_E_2018$site == 'SERC' |
                                                          tick_path_Bb_col_E_2018$site == 'ORNL'), ]


# reorder sites from north to south
tick_path_Bb_col_E_2018$site = factor(tick_path_Bb_col_E_2018$site, 
                            levels = c('HARV',
                                       'SERC', 
                                       'ORNL'),
                            labels = c('HARV - NORTHEAST',
                                       'SERC - MID ATLANTIC',
                                       'ORNL - APPALACHIANS'))



P2018 <- ggplot(data = tick_path_Bb_col_E_2018,
aes(y = incidence, x = as.Date(Date)))+
  facet_wrap(~site,ncol = 1)+ # add scale = 'free_y', if you want to see some close up data
  theme(strip.background = element_rect(fill = 'gray95'))+
  theme(strip.text.x = element_text(face = 'bold'))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), alpha = .3)+
  clean_background +
  rotatexaxistheme +
  multiplottitletheme+
  ytitletheme +
  xtitletheme +
  labs(x = "Collection Date (2018)",y = 'B. burgdorferi incidence')
P2018
ggsave("geombbincidence2018.pdf", dpi = 320)



```



```{r}
View(mamsTrap_col_E$capture)

ggplot(mamsTrap_col_E, aes(y = capture, x = as.Date(collectDate)))+
  geom_point()
```




~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

*version 1 on 9/28/20*

## Graph type 1

*Aggregated questing tick abundances by site by life stage per year*

+ Don't think these graphs are useful for the proposal but it was easier for me to visualize which sites are sampling more often

+ Not a lot of data for larvae from 2016 and 2017 so those years were omitted, there is one sampling event > 3000 larvae were collected but omitted it to make a more cohesive graph


```{r broken down by life stage then year}

## LARVAE

# 2016
dateVec16<- seq(from = as.Date("2016-03-01"), to = (as.Date("2016-11-30")),
              by = '1 month')
sixteenL<- ggplot(data = I_scap_L_col, aes(x = as.Date(collectDate), y = individualCount))+
  geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  coord_cartesian(ylim = c(0,2))+
  scale_y_continuous(breaks = seq(0,2,1))+
  clean_background+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec16), max(dateVec16)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2016")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')


# 2017
dateVec17<- seq(from = as.Date("2017-03-01"), to = (as.Date("2017-11-30")),
              by = '1 month')
seventeenL<- ggplot(data = I_scap_L_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  scale_y_continuous(breaks = seq(0,2,1))+
  clean_background+
  coord_cartesian(ylim = c(0, 2))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec17), max(dateVec17)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2017")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')


# not broken down by site
# just 2018
dateVec18<- seq(from = as.Date("2018-03-01"), to = (as.Date("2018-11-30")),
              by = '1 month')
eighteenL<- ggplot(data = I_scap_L_col, aes(x = as.Date(collectDate), y = individualCount))+
    geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 700))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec18), max(dateVec18)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2018")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')

# just 2019
dateVec19<- seq(from = as.Date("2019-03-01"), to = (as.Date("2019-11-30")),
              by = '1 month')
nineteenL <-ggplot(data = I_scap_L_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 1000))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec19), max(dateVec19)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2019")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')

# compare 2018 & 2019

comboL<- ggarrange(eighteenL + rremove('xlab') + rremove('ylab') + rremove('legend'), 
                  nineteenL + rremove('xlab') + rremove('ylab'),
          align = 'v',
          common.legend = TRUE, legend = 'bottom')

annotate_figure(comboL,
                top = text_grob('Larvae',
                                face = 'bold',
                                color = 'black',
                                size = '12'),
                left = text_grob('Total questing ticks per sampling',
                face = 'bold',
                size = '10',
                rot = '90',
                hjust = .25))



####### NYMPHS

# just 2016
dateVec16<- seq(from = as.Date("2016-03-01"), to = (as.Date("2016-11-30")),
              by = '1 month')
sixteenN <- ggplot(data = I_scap_N_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 40))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec16), max(dateVec16)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2016")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')


# just 2017
dateVec17<- seq(from = as.Date("2017-03-01"), to = (as.Date("2017-11-30")),
              by = '1 month')
seventeenN <- ggplot(data = I_scap_N_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 50))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec17), max(dateVec17)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2017")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')


# not broken down by site
# just 2018
dateVec18<- seq(from = as.Date("2018-03-01"), to = (as.Date("2018-11-30")),
              by = '1 month')
eighteenN <- ggplot(data = I_scap_N_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 45))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec18), max(dateVec18)))+
  theme(axis.text.x = element_text(angle = 40, size = 8, vjust = 0.5))+
  ggtitle("2018")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')

# just 2019
dateVec19<- seq(from = as.Date("2019-03-01"), to = (as.Date("2019-11-30")),
              by = '1 month')
nineteenN <-ggplot(data = I_scap_N_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 100))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec19), max(dateVec19)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2019")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')

# compare 2018 & 2019
#library(ggpubr)
comboN<- ggarrange(sixteenN + rremove('xlab') + rremove('ylab') + rremove('legend'),
                  seventeenN + rremove('xlab') + rremove('ylab') + rremove('legend'),
                  eighteenN + rremove('xlab') + rremove('ylab') + rremove('legend'), 
                  nineteenN + rremove('xlab') + rremove('ylab')+
                    rremove('legend'),
          align = 'v',
          common.legend = TRUE, legend = 'bottom')

annotate_figure(comboN,
                top = text_grob('Nymphs',
                                face = 'bold',
                                color = 'black',
                                size = '12'),
                left = text_grob('Total questing ticks per sampling',
                face = 'bold',
                size = '10',
                rot = '90',
                hjust = .25))


### ADULTS
# just 2016
## A lot of adults were sampled late in 2016 so i'm including them in the analysis
dateVec16A<- seq(from = as.Date("2016-03-01"), to = (as.Date("2016-12-30")),
              by = '1 month')
sixteenA <- ggplot(data = I_scap_A_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 6))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec16A), max(dateVec16A)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2016")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')


# just 2017
dateVec17A<- seq(from = as.Date("2017-03-01"), to = (as.Date("2017-08-30")),
              by = '1 month')
seventeenA <- ggplot(data = I_scap_A_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 6))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec17), max(dateVec17A)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2017")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')


# not broken down by site
# just 2018
dateVec18<- seq(from = as.Date("2018-03-01"), to = (as.Date("2018-10-30")),
              by = '1 month')
eighteenA <- ggplot(data = I_scap_A_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 10))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec18), max(dateVec18)))+
  theme(axis.text.x = element_text(angle = 40, size = 8, vjust = 0.5))+
  ggtitle("2018")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')

# just 2019
dateVec19<- seq(from = as.Date("2019-03-01"), to = (as.Date("2019-10-30")),
              by = '1 month')
nineteenA <-ggplot(data = I_scap_A_col, aes(x = as.Date(collectDate), y = individualCount))+
   geom_jitter(alpha = 0.5, aes(color = site), size = 2.5,
              position = position_jitterdodge())+
  clean_background+
  coord_cartesian(ylim = c(0, 10))+
  scale_x_date(date_labels = "%m-%Y", 
               limits = c(min(dateVec19), max(dateVec19)))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2019")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 10,  color = 'black', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Date",y = 'Individual tick counts \n by site per sampling')

# compare 2018 & 2019
#library(ggpubr)
comboA<- ggarrange(sixteenA + rremove('xlab') + rremove('ylab') + rremove('legend'),
                  seventeenA + rremove('xlab') + rremove('ylab') + rremove('legend'),
                  eighteenA + rremove('xlab') + rremove('ylab') + rremove('legend'), 
                  nineteenA + rremove('xlab') + rremove('ylab')+
                    rremove('legend'),
          align = 'v',
          common.legend = TRUE, legend = 'bottom')

annotate_figure(comboA,
                top = text_grob('Adults',
                                face = 'bold',
                                color = 'black',
                                size = '12'),
                left = text_grob('Total questing ticks per sampling',
                face = 'bold',
                size = '10',
                rot = '90',
                hjust = .25))

```


## Graph type 2

*Aggregated questing nymphal abundances by site by month per year

+ I think the phenology of nymphs stand out more when ncol = 4 vs nrow = 4

+ Not a lot of data for larvae from 2016 and 2017 so those years were omitted, there is one sampling event > 3000 larvae were collected but omitted it to make a more cohesive graph.

+ There was a lot of adult data per year to make good geom_smooth() plots, so I have commented them out unless you want to keep them.

```{r}

# extract month
I_scap_L$Month <- substr(I_scap_L$collectDate, 6, nchar(I_scap_L$collectDate)-3)
I_scap_N$Month <- substr(I_scap_N$collectDate, 6, nchar(I_scap_N$collectDate)-3)
I_scap_A$Month <- substr(I_scap_A$collectDate, 6, nchar(I_scap_A$collectDate)-3)

## LARVAE

# # 2016
# I_scap_L_2016 <- I_scap_L[which(I_scap_L$Year == '2016'), ]
# #str(I_scap_L_2016$MoLth)
# I_scap_L_2016 <- I_scap_L_2016[which(I_scap_L_2016$Month < "09"),]
# I_scap_L_2016 <- I_scap_L_2016[which(I_scap_L_2016$Month > "03"),]
# ####View(I_scap_L_2016)
# # poiLt aLd liLe
# L2016 <- ggplot(data = I_scap_L_2016,
# aes(y = individualCount, x = as.Date(collectDate)))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
#               alpha = .3)+
#   clean_background +
#   theme(plot.margin = unit(c(0,0.4,3,0), "lines")) +
#   theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
#   ggtitle("2016")+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))
# 
# 
# 
# #2017
# I_scap_L_2017 <- I_scap_L[which(I_scap_L$Year == '2017'),]
# I_scap_L_2017 <- I_scap_L_2017[which(I_scap_L_2017$Month < "09"),]
# #I_scap_N_2017 <- I_scap_N_2017[which(I_scap_N_2017$Month > "04"),]
# # point and line
# L2017 <- ggplot(I_scap_L_2017, aes(y = individualCount, x = as.Date(collectDate)))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
#               alpha = .3)+
#   clean_background +
#   theme(plot.margin = unit(c(0,0.1,3,0), "lines")) +
#   theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
#   ggtitle("2017")+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))
#   


# 2018
I_scap_L_2018 <- I_scap_L[which(I_scap_L$Year == '2018'),]
#I_scap_L_2018 <- I_scap_L_2018[which(I_scap_L_2018$Month < "11"),]
# point and line
L2018 <- ggplot(I_scap_L_2018, aes(y = individualCount, x = as.Date(collectDate)))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
              alpha = .3)+
  clean_background +
  theme(plot.margin = unit(c(0,0.9,3,0), "lines")) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2018")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10, color = 'red', vjust = -6))

# 2019
I_scap_L_2019 <- I_scap_L[which(I_scap_L$Year == '2019'),]
#I_scap_L_2019 <- I_scap_L_2019[which(I_scap_L_2019$Month < "11"),]
# point and line
L2019 <- ggplot(I_scap_L_2019, aes(y = individualCount, x = as.Date(collectDate)))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
              alpha = .3) +
 # scale_y_discrete(breaks = 1000:3000)+
  ylim(0,1000)+ # this is hiding some outliers..
    clean_background +
  theme(plot.margin = unit(c(0,1,3,0), "lines"))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2019")+
  theme(plot.title = element_text(face = 'bold', color = 'red', hjust = .1, size = 10, vjust = -6))
  


larvaperyear <- ggarrange(
          L2018 + rremove('xlab') + rremove('ylab'),
          L2019 + rremove('xlab') + rremove('ylab'),
          #labels=c("2016", "2017", "2018", "2019"),
          nrow = 1,
          align = 'h',
          widths=c(1, 1, 1, 1, 1))



finallarvaquesting <- annotate_figure(larvaperyear,
                top = text_grob("Questing Larvae", 
                                hjust = .5,
                                face = 'bold', size = 14),
                left = text_grob("Total ticks per sampling", rot = 90, face = 'bold'))

finallarvaquesting

# save image to your computer
ggsave("finallarvaquesting.pdf", dpi = 320)



## NYMPHS


# 2016
I_scap_N_2016 <- I_scap_N[which(I_scap_N$Year == '2016'), ]
#str(I_scap_N_2016$Month)
I_scap_N_2016 <- I_scap_N_2016[which(I_scap_N_2016$Month < "09"),]
I_scap_N_2016 <- I_scap_N_2016[which(I_scap_N_2016$Month > "03"),]
####View(I_scap_N_2016)


# point and line
N2016 <- ggplot(data = I_scap_N_2016,
aes(y = individualCount, x = as.Date(collectDate)))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
              alpha = .3)+
  clean_background +
  theme(plot.margin = unit(c(0,0.4,3,0), "lines")) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2016")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))



#2017
I_scap_N_2017 <- I_scap_N[which(I_scap_N$Year == '2017'),]
I_scap_N_2017 <- I_scap_N_2017[which(I_scap_N_2017$Month < "09"),]
#I_scap_N_2017 <- I_scap_N_2017[which(I_scap_N_2017$Month > "04"),]
# point and line
N2017 <- ggplot(I_scap_N_2017, aes(y = individualCount, x = as.Date(collectDate)))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
              alpha = .3)+
  clean_background +
  theme(plot.margin = unit(c(0,0.1,3,0), "lines")) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2017")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))
  


# 2018
I_scap_N_2018 <- I_scap_N[which(I_scap_N$Year == '2018'),]
I_scap_N_2018 <- I_scap_N_2018[which(I_scap_N_2018$Month < "09"),]
# point and line
N2018 <- ggplot(I_scap_N_2018, aes(y = individualCount, x = as.Date(collectDate)))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
              alpha = .3)+
  clean_background +
  theme(plot.margin = unit(c(0,0.9,3,0), "lines")) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2018")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10, color = 'red', vjust = -6))

# 2019
I_scap_N_2019 <- I_scap_N[which(I_scap_N$Year == '2019'),]
I_scap_N_2019 <- I_scap_N_2019[which(I_scap_N_2019$Month < "09"),]
# point and line
N2019 <- ggplot(I_scap_N_2019, aes(y = individualCount, x = as.Date(collectDate)))+
  geom_point() +
  geom_smooth(se = FALSE, color = 'red')+
  stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
              alpha = .3) +
    clean_background +
  theme(plot.margin = unit(c(0,1,3,0), "lines"))+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("2019")+
  theme(plot.title = element_text(face = 'bold', color = 'red', hjust = .1, size = 10, vjust = -6))
  


nymphsperyear <- ggarrange(N2016 + rremove('xlab') + rremove('ylab') , 
          N2017 + rremove('xlab') + rremove('ylab'),
          N2018 + rremove('xlab') + rremove('ylab'),
          N2019 + rremove('xlab') + rremove('ylab'),
          #labels=c("2016", "2017", "2018", "2019"),
          nrow = 1,
          align = 'h',
          widths=c(1, 1, 1, 1, 1))

finalnymphquesting <- annotate_figure(nymphsperyear,
                top = text_grob("Questing Nymphs", 
                                hjust = .5,
                                face = 'bold', size = 14),
                left = text_grob("Total ticks per sampling", rot = 90, face = 'bold'))

finalnymphquesting

# save image to your computer
ggsave("finalnymphquesting.pdf", dpi = 320)




## ADULTS


# # 2016
# I_scap_A_2016 <- I_scap_A[which(I_scap_A$Year == '2016'), ]
# #str(I_scap_A_2016$MoLth)
# #I_scap_A_2016 <- I_scap_A_2016[which(I_scap_A_2016$Month < "09"),]
# #I_scap_A_2016 <- I_scap_A_2016[which(I_scap_A_2016$Month > "03"),]
# ####View(I_scap_A_2016)
# # poiLt aLd liLe
# A2016 <- ggplot(data = I_scap_A_2016,
# aes(y = individualCount, x = as.Date(collectDate)))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)),
#               alpha = .3)+
#   clean_background +
#   theme(plot.margin = unit(c(0,0.4,3,0), "lines")) +
#   theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
#   ggtitle("2016")+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))
# 
# 
# 
# #2017
# I_scap_A_2017 <- I_scap_A[which(I_scap_A$Year == '2017'),]
# #I_scap_A_2017 <- I_scap_A_2017[which(I_scap_A_2017$Month < "09"),]
# #I_scap_N_2017 <- I_scap_N_2017[which(I_scap_N_2017$Month > "04"),]
# # point and line
# A2017 <- ggplot(I_scap_A_2017, aes(y = individualCount, x = as.Date(collectDate)))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)),
#               alpha = .3)+
#   clean_background +
#   theme(plot.margin = unit(c(0,0.1,3,0), "lines")) +
#   theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
#   ggtitle("2017")+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))
# 
# 
# 
# # 2018
# I_scap_A_2018 <- I_scap_A[which(I_scap_A$Year == '2018'),]
# #I_scap_A_2018 <- I_scap_A_2018[which(I_scap_A_2018$Month < "11"),]
# # point and line
# A2018 <- ggplot(I_scap_A_2018, aes(y = individualCount, x = as.Date(collectDate)))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
#               alpha = .3)+
#   clean_background +
#   theme(plot.margin = unit(c(0,0.9,3,0), "lines")) +
#   theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
#   ggtitle("2018")+
#   theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10, color = 'red', vjust = -6))
# 
# # 2019
# I_scap_A_2019 <- I_scap_A[which(I_scap_A$Year == '2019'),]
# #I_scap_A_2019 <- I_scap_A_2019[which(I_scap_A_2019$Month < "11"),]
# # point and line
# A2019 <- ggplot(I_scap_A_2019, aes(y = individualCount, x = as.Date(collectDate)))+
#   geom_point() +
#   geom_smooth(se = FALSE, color = 'red')+
#   stat_smooth(geom='ribbon', aes(ymin = ifelse(..ymin.. < 0, 0, ..ymin..)), 
#               alpha = .3) +
#  # scale_y_discrete(breaks = 1000:3000)+
#  # ylim(0,1500)+ # this is hiding some outliers..
#     clean_background +
#   theme(plot.margin = unit(c(0,1,3,0), "lines"))+
#   theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
#   ggtitle("2019")+
#   theme(plot.title = element_text(face = 'bold', color = 'red', hjust = .1, size = 10, vjust = -6))
#   
# 
# 
# adultsperyear <- ggarrange(A2016 + rremove('xlab') + rremove('ylab'),
#                            A2017 + rremove('xlab') + rremove('ylab'),
#           A2018 + rremove('xlab') + rremove('ylab'),
#           A2019 + rremove('xlab') + rremove('ylab'),
#           #labels=c("2016", "2017", "2018", "2019"),
#           nrow = 1,
#           align = 'h',
#           widths=c(1, 1, 1, 1, 1))
# 
# 
# finaladultsquesting <- annotate_figure(adultsperyear,
#                 top = text_grob("Questing Adults", 
#                                 hjust = .5,
#                                 face = 'bold', size = 14),
#                 left = text_grob("Total ticks per sampling", rot = 90, face = 'bold'))
# 
# finaladultsquesting
# ggsave("finaladultsquesting.pdf", dpi = 320)


```


## **Graph type 3**

*Boxplots of total questing ticks by life stage and month per sampling (Years 2014 - 2019)*

+ Just another way to visualize the phenology

```{r boxplot by life stage by month}

## Clean up data set

# choose columns site ID, collectDate,totalSampledArea,targetTaxaPresent, adultcount, nymphalcount, larvalcount
ticks_area <- ticks[,c(4,5,15,20,21,22,23,24)]
#View(ticks_area)

# assuming that targeted taxa is Ixodes so will select Y
ticks_area_ixodes <- ticks_area[which(ticks_area$targetTaxaPresent == 'Y'),]
#View(ticks_area_ixodes)

# select sites for this study
ticks_area_sampled <- ticks_area_ixodes[which(ticks_area_ixodes$site == 'BART' | ticks_area_ixodes$site == 'HARV' | ticks_area_ixodes$site == 'BLAN' | ticks_area_ixodes$site == 'SCBI' | ticks_area_ixodes$site == 'SERC' | ticks_area_ixodes$site == 'OSBS' | ticks_area_ixodes$site == 'STEI' | ticks_area_ixodes$site == 'TREE' | ticks_area_ixodes$site == 'UNDE' | ticks_area_ixodes$site == 'GRSM' | ticks_area_ixodes$site == 'MLBS' | ticks_area_ixodes$site == 'ORNL' | ticks_area_ixodes$site == 'TALL'),]

#View(ticks_area_sampled)

# new column total larvae sampled per area
ticks_area_sampled$larvaeperarea <- (ticks_area_sampled$larvaCount/ticks_area_sampled$totalSampledArea)
#View(ticks_area_sampled)

# new column total nymphs sampled per area
ticks_area_sampled$nymphsperarea <- (ticks_area_sampled$nymphCount/ticks_area_sampled$totalSampledArea)
#View(ticks_area_sampled)

# new column total adults sampled per area
ticks_area_sampled$adultsperarea <- (ticks_area_sampled$adultCount/ticks_area_sampled$totalSampledArea)
#View(ticks_area_sampled)

# reformat collect Date
ticks_area_sampled$CollectDate <- as.character(ticks_area_sampled$collectDate)

ticks_area_sampled$CollectDate <- substr(ticks_area_sampled$CollectDate, 1, nchar(ticks_area_sampled$CollectDate)-7)

# extract year
ticks_area_sampled$Year <- substr(ticks_area_sampled$CollectDate, 1, nchar(ticks_area_sampled$CollectDate)-6)


#unique(ticks_area_sampled$Year)

# keep years with data 2014, 2015, 2016, 2017, 2018 
ticks_area_sampled_years <- ticks_area_sampled[which(ticks_area_sampled$Year == '2014'|
                                    ticks_area_sampled$Year == '2015' |
                                    ticks_area_sampled$Year == '2016' |
                                    ticks_area_sampled$Year == '2017' |
                                    ticks_area_sampled$Year == '2018'),]
#View(ticks_area_sampled_years)

# extract month
ticks_area_sampled_years$Month <- substr(ticks_area_sampled_years$CollectDate, 6, nchar(ticks_area_sampled_years$CollectDate)-3)

ticks_area_sampled_years_month <- ticks_area_sampled_years[which(ticks_area_sampled_years$Month < "11"),]
#View(ticks_area_sampled_years_month)
# clean up this data set and keep relevant columns

ticksperarea <- ticks_area_sampled_years_month
#View(ticksperarea)

### Let's plot


## LARVAE
ticks_area_L <- aggregate(larvaCount ~ siteID + CollectDate + Year + + Month + totalSampledArea, data=ticksperarea, FUN=sum)

l <- ggplot(ticks_area_L, aes(y = larvaCount, x = Month))+
  geom_boxplot(fill='#A4A4A4', color="black") +
  coord_cartesian(ylim = c(0, 3000))+
  clean_background+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks per sampling',
  title = 'Larvae')

## NYMPHS
ticks_area_N <- aggregate(nymphCount ~ siteID + CollectDate + Year + Month +totalSampledArea, data=ticksperarea, FUN=sum)

n <- ggplot(ticks_area_N, aes(y = nymphCount, x = Month))+
  geom_boxplot(fill='#A4A4A4', color="black") +
  coord_cartesian(ylim = c(0, 300))+
  clean_background+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  theme(plot.title = element_text(face = 'bold', hjust = 0.1, size = 10,  color = 'red', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks per sampling',
  title = 'Nymphs')

## ADULTS
ticks_area_A <- aggregate(adultCount ~ siteID + CollectDate + Year + Month +totalSampledArea, data=ticksperarea, FUN=sum)


a <- ggplot(ticks_area_A, aes(y = adultCount, x = Month))+
  geom_boxplot(fill='#A4A4A4', color="black") +
  coord_cartesian(ylim = c(0, 50))+
  clean_background+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  theme(plot.title = element_text(face = 'bold',hjust = 0.1, size = 10,  color = 'red', vjust = -6))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks per sampling',
  title = 'Adults')

boxlna<- ggarrange(l + rremove('xlab') + rremove('ylab') + rremove('legend'),
          n + rremove('xlab') + rremove('ylab') + rremove('legend'),
          a + rremove('xlab') + rremove('ylab') + rremove('legend'),
          ncol = 3,
          widths=c(1.3, 1.3, 1.3))
annotate_figure(boxlna,
                top = text_grob('Total ticks per sampling (Years 2014 - 2019)',
                                face = 'bold',
                                color = 'black',
                                size = '12'),
                 bottom = text_grob("Month",face = 'bold', hjust = .5),
                left = text_grob("Total questing ticks",face = 'bold', rot = 90,hjust = .5))


```


## **Graph type 4**

*Total questing ticks sampled per area (m) size with siteID*

+ These graphs were less interesting to me but I can fiddle around with them more

**Type 4.A with no site identifier**

```{r no site identifier}

## LARVAE
ggplot(data = ticks_area_L, aes(x = Month, y = larvaCount)) +
  clean_background +
   geom_point(alpha = 0.2, aes(size = totalSampledArea))+
  scale_size(range = c(.1,5), name = 'Total Sampled Area (m)',
             breaks = c(75,100,125,150,175,200))+
  coord_cartesian(ylim = c(0,3000)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("Ticks per sampled area")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks',
  #subtitle = 'Proportion of ticks sampled per area (m)',
  title = 'Larvae per area (m)')


## Nymphs
ggplot(data = ticks_area_N, aes(x = Month, y = nymphCount)) +
  clean_background +
   geom_point(alpha = 0.2, aes(size = totalSampledArea))+
  scale_size(range = c(.1,5), name = 'Total Sampled Area (m)',
             breaks = c(75,100,125,150,175,200))+
  coord_cartesian(ylim = c(0,250)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("Ticks per sampled area")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks',
  #subtitle = 'Proportion of ticks sampled per area (m)',
  title = 'Nymphs per area (m)')

## ADULTS
ggplot(data = ticks_area_A, aes(x = Month, y = adultCount)) +
  clean_background +
   geom_point(alpha = 0.2, aes(size = totalSampledArea))+
  scale_size(range = c(.1,5), name = 'Total Sampled Area (m)',
             breaks = c(75,100,125,150,175,200))+
  coord_cartesian(ylim = c(0,50)) +
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("Ticks per sampled area")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks',
  #subtitle = 'Proportion of ticks sampled per area (m)',
  title = 'Adults per area (m)')

```


**Type 4.B with site identifier**

+ Still not sure how helpful these graphs are

```{r with site identifier}

## LARVAE
ggplot(data = ticks_area_L, aes(x = Month, y = larvaCount)) +
  clean_background +
  facet_wrap(~Year, ncol = 5)+
   geom_point(alpha = 0.2, aes(size = totalSampledArea, color = siteID))+
   scale_size(range = c(.1, 5),name = 'Total Sampled Area (m)',
             breaks = c(100,120,140,160,180,200))+
  coord_cartesian(ylim = c(0,2200)) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("Ticks per sampled area")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks',
  subtitle = 'Color represents siteID',
  title = 'Larvae per area (m) by month and site')+
  guides(size = guide_legend(order = 1),
         color = FALSE)+
  theme(legend.position = 'bottom', legend.box = 'horizontal')

## NYMPHS
ggplot(data = ticks_area_N, aes(x = Month, y = nymphCount)) +
  clean_background +
  facet_wrap(~Year, ncol = 5)+
   geom_point(alpha = 0.2, aes(size = totalSampledArea, color = siteID))+
   scale_size(range = c(.1, 5),name = 'Total Sampled Area (m)',
             breaks = c(100,120,140,160,180,200))+
  coord_cartesian(ylim = c(0,250)) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("Ticks per sampled area")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks',
  subtitle = 'Color represents siteID',
  title = 'Nymphs per area (m) by month and site')+
  guides(size = guide_legend(order = 1),
         color = FALSE)+
  theme(legend.position = 'bottom', legend.box = 'horizontal')

## Adults
ggplot(data = ticks_area_A, aes(x = Month, y = adultCount)) +
  clean_background +
  facet_wrap(~Year, ncol = 5)+
   geom_point(alpha = 0.2, aes(size = totalSampledArea, color = siteID))+
   scale_size(range = c(.1, 5),name = 'Total Sampled Area (m)',
             breaks = c(100,120,140,160,180,200))+
  coord_cartesian(ylim = c(0,50)) +
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5))+
  ggtitle("Ticks per sampled area")+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  theme(axis.text.x = element_text(face = 'bold'))+
  labs(x = "Month",y = 'Total ticks',
  subtitle = 'Color represents siteID',
  title = 'Adults per area (m) by month and site')+
  guides(size = guide_legend(order = 1),
         color = FALSE)+
  theme(legend.position = 'bottom', legend.box = 'horizontal')
```


## **Graph type 5**

+ Attached mammal ticks in Yes/No format

+ This data is not as great, but let me know if there's another way you would like me to represent it

**Type 5.A represents mammal sample size**

```{r}
# get rid of non-Y or N for larvae

attachedticks <- mamsTrap_captures[which(mamsTrap_captures$larvalTicksAttached == 'Y' | mamsTrap_captures$larvalTicksAttached == 'N'),]
attachedticks <- attachedticks[which(attachedticks$nymphalTicksAttached == 'Y'|attachedticks$nymphalTicksAttached == 'N'),]
#unique(attachedticks$nymphalTicksAttached)


# choose only relevant sites
attachedticks <- attachedticks[which(attachedticks$site == 'BART' | attachedticks$site == 'HARV' | attachedticks$site == 'BLAN' | attachedticks$site == 'SCBI' | attachedticks$site == 'SERC' | attachedticks$site == 'OSBS' | attachedticks$site == 'STEI' | attachedticks$site == 'TREE' | attachedticks$site == 'UNDE' | attachedticks$site == 'GRSM' | attachedticks$site == 'MLBS' | attachedticks$site == 'ORNL' | attachedticks$site == 'TALL'),]
                   

## separate
ll<- ggplot(attachedticks, aes(x = siteID,y =larvalTicksAttached))+
  geom_count(aes(x = siteID,y =larvalTicksAttached,), color = 'blue', alpha = .9)+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5, face = 'bold'))+
  clean_background+
  ggtitle('Attached Larvae')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 8, vjust = -5))+
  labs(x = "SiteID",y = 'Mammals with attached ticks',
       size = 'Sample size (n)')


nn<- ggplot(attachedticks, aes(x = siteID,y = nymphalTicksAttached))+
  geom_count(aes(x = siteID,y =nymphalTicksAttached,), color = 'red', alpha = .9)+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5, face = 'bold'))+
  clean_background+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  labs(x = "SiteID",y = 'Mammals with attached ticks',
       size = 'Sample size (n)')+
  ggtitle('Attached Nymphs')+
  theme(plot.title = element_text(face = 'bold', hjust = 0.04, size = 8, vjust = -5))

attached <- ggarrange(ll + rremove('xlab') + rremove('ylab'),
          nn + rremove('xlab')+ rremove('ylab'), 
          nrow = 2, 
          align = 'v')

annotate_figure(attached,
                top = text_grob("Attached mammal ticks", 
                                hjust = .5,
                                face = 'bold', size = 12),
                left = text_grob("Attached ticks (Yes/No)", rot = 90, face = 'bold'),
                bottom = text_grob("SiteID", 
                                hjust = .3,
                                face = 'bold', size = 12))
```


**Type 5.B**

+ I was trying to combine two plots into one, but the No for nymphs overshadows the larval data
+ I can keep fiddling around with this figure to make aesthetics more appealing/easy to interpret

```{r overlapping}


# point yn for larva & nymphs
ggplot(attachedticks, aes(x = siteID,y =larvalTicksAttached))+
  geom_count(aes(x = siteID,y =larvalTicksAttached, color = 'blue'), alpha = .9)+
  geom_count(aes(x = siteID,y = nymphalTicksAttached, color = 'lightyellow'),alpha = .5)+
  theme(axis.text.x = element_text(angle = 45, size = 8, vjust = 0.5, face = 'bold'))+
  clean_background+
  theme(plot.title = element_text(face = 'bold', hjust = 0.5))+
  labs(x = "SiteID",y = 'Mammals with attached ticks',
       color = 'Tick life stage',
       size = 'Sample size (n)')+
  scale_color_manual(labels = c('larvae','nymphs'),
                     values = c('orange', 'lightblue'))

```


## Graph type 6

*Histogram of attached ticks by life stage*

+ Not really helpful I don't think for the proposal, I think mosaic plot was a helpful way for me to visualize this data but it basically highlights that there's less attached tick data to use vs. attached tick data which may not help part of the proposal that suggests using larval burden data to make up for the lack of questing larval data in 2016/2017

```{r histogram attached ticks}
al <- ggplot(attachedticks, aes(larvalTicksAttached))+
  geom_histogram(stat = 'count')+
  clean_background+
  labs(x = "Attached Ticks", y = 'Count')+
  ggtitle('Attached Larvae (No/Yes)')
  
an <- ggplot(attachedticks, aes(nymphalTicksAttached))+
  geom_histogram(stat = 'count')+
  clean_background+
  labs(x = "Attached Ticks", y = 'Count')+
  ggtitle('Attached Nymphs (No/Yes)')

ggarrange(al,an)
```



